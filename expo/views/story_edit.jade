extends sticker_add_layout

block content  
  div(class='container')
    div(class='header')
      nav
        ul(class='nav nav-pills pull-right')
          li(role='presentation', class='active')
            a(href='/stickers/add') Sticker
          li(role='presentation')
            a(href='/pictures/add') Picture
      h3(class='text-muted') Edit Story
    div(class='jumbotron')                    
      #sticker_form(style="width: 580px ; height: 500px")
        div(class="w2ui-page page-0")
          div(class="w2ui-field")
            label Title:
            div
              input(name="title", type="text", maxlenght="100", size="60", style="width: 423px")
          div(class="w2ui-field")
            label Author:
            div
              input(name="author", type="author", maxlenght="100", size="60", style="width: 423px")
          div(class="w2ui-field")
            label Content:
            div
              textarea(name="content", type="text", maxlength="800", size="60", style="width: 400px; height: 200px;")
                  
          div(class="w2ui-buttons")
            button(class="btn", name="reset") Reset
            button(class="btn", name="save") Save  
  
  script(type="text/javascript").
    $(function () {    
      $('#sticker_form').w2form({
        name  : 'sticker_form',
        url   : '/storys/edit',
        fields: [
          { field: 'title',    type: 'text' },
          { field: 'author',   type: 'text' },          
          { field: 'content',  type: 'textarea'},
        ],
        record: {
          'title': "!{sticker.title}",
          'author': "!{sticker.author}",
          'sid' : #{sticker.sid},
          'kind': #{sticker.kind}
        },
        actions: {
          reset: function () {
            this.clear();
          },
          save: function () {
            //this.save();
            
            var html = CKEDITOR.instances.content.getData();
            this.record.content = html;
            console.log(html);
                        
            w2ui.sticker_form.lock('Loading...', true);
            
            $.ajax({
              type: "POST",
              url: this.url,
              data: JSON.stringify(this.record),
              contentType: "application/json; charset=utf-8",
              dataType: "json",
              processData: true,
              success: function (data, status, jqXHR) {
                w2ui.sticker_form.unlock();
                window.top.location.href = "/";
                //console.log(data);
              },
              error: function (xhr) {
                w2ui.sticker_form.unlock();
                alert(xhr.statusText);
              }
            });
            // continue here
            
          }
        },
      });
      
      CKEDITOR.replace('content');
      CKEDITOR.instances.content.setData("!{sticker.content}");
    });
    
